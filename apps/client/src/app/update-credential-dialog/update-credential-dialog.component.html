<div *ngIf="loading" class="center-content">
  <mat-spinner></mat-spinner>
</div>

<div *ngIf="!loading && !error">
  <mat-form-field class="fill">
    <input
      matInput
      [(ngModel)]="password"
      (keydown)="keyDown($event)"
      [placeholder]="id ? '*****' : 'password'"
      #input
      (focus)="$event.target.select()"
    />
  </mat-form-field>
  <br />
  <woizpass-password-generator
    (generated)="password = $event"
  ></woizpass-password-generator>
  <br />
  <br />
  <mat-form-field class="fill" autofocus="false">
    <input
      matInput
      [(ngModel)]="provider"
      (keydown)="keyDown($event)"
      placeholder="provider"
      #input
      (focus)="$event.target.select()"
      type="text"
      [matAutocomplete]="providerAuto"
      [formControl]="providerControl"
      autofocus="false"
    />
    <mat-autocomplete #providerAuto="matAutocomplete">
      <mat-option
        *ngFor="let option of filteredProviders | async"
        [value]="option"
      >
        {{ option }}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>
  <br />
  <mat-form-field class="fill">
    <input
      matInput
      [(ngModel)]="email"
      (keydown)="keyDown($event)"
      placeholder="email"
      #input
      (focus)="$event.target.select()"
      type="text"
      [matAutocomplete]="emailAuto"
      [formControl]="emailControl"
    />
    <mat-autocomplete #emailAuto="matAutocomplete">
      <mat-option
        *ngFor="let option of filteredEmails | async"
        [value]="option"
      >
        {{ option }}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>
  <br />
  <mat-form-field class="fill">
    <input
      matInput
      [(ngModel)]="username"
      (keydown)="keyDown($event)"
      placeholder="username"
      #input
      (focus)="$event.target.select()"
      type="text"
      [matAutocomplete]="usernameAuto"
      [formControl]="usernameControl"
    />
    <mat-autocomplete #usernameAuto="matAutocomplete">
      <mat-option
        *ngFor="let option of filteredUsernames | async"
        [value]="option"
      >
        {{ option }}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>
  <br />
  <mat-form-field class="fill">
    <textarea
      matInput
      cdkTextareaAutosize
      #autosize="cdkTextareaAutosize"
      [(ngModel)]="comment"
      (keydown)="keyDown($event)"
      placeholder="comment"
    ></textarea>
  </mat-form-field>
  <br />
  <br />
  <button
    mat-raised-button
    color="primary"
    class="fill"
    [disabled]="!provider || !(email || username) || (!id && !password)"
    (click)="submit()"
  >
    SAVE
  </button>
  <br />
  <br />
  <button mat-raised-button class="fill" mat-dialog-close>CANCEL</button>
</div>

<div *ngIf="!loading && error">
  <p>{{ error }}</p>
  <button mat-raised-button class="fill" color="primary" mat-dialog-close>
    OK
  </button>
</div>
